# üåä Manual de Flujo de Datos - Rosema POS

## üéØ ¬øQu√© es el Flujo de Datos?

El **flujo de datos** es como el agua que corre por las tuber√≠as de tu casa. En tu app, los datos (productos, ventas, clientes) "fluyen" desde Firebase hasta la pantalla del usuario, y viceversa.

---

## üöÄ Flujo Principal de la Aplicaci√≥n

```mermaid
graph TD
    A[üë§ Usuario abre la app] --> B{üîê ¬øEst√° logueado?}
    B -->|‚ùå No| C[üì± Pantalla de Login]
    B -->|‚úÖ S√≠| D[üè† Pantalla Principal]
    
    C --> E[üîë Ingresa credenciales]
    E --> F[üî• Firebase Auth verifica]
    F -->|‚úÖ Correcto| D
    F -->|‚ùå Error| C
    
    D --> G[üìã Sidebar con opciones]
    G --> H[üõí Ventas]
    G --> I[üì¶ Productos]
    G --> J[üë• Clientes]
    G --> K[üìä Estad√≠sticas]
    
    style A fill:#e1f5fe
    style D fill:#e8f5e8
    style H fill:#fff3e0
    style I fill:#f3e5f5
```

**Para principiantes:** Este diagrama muestra el primer flujo cuando abres la app.

---

## üõí Flujo del Sistema de Ventas

```mermaid
sequenceDiagram
    participant U as üë§ Usuario
    participant S as üì± Sales.jsx
    participant PS as üîç ProductSearch
    participant FS as üî• Firebase
    participant C as üõí SalesCart
    
    U->>S: 1. Abre p√°gina de ventas
    S->>PS: 2. Carga b√∫squeda de productos
    PS->>FS: 3. Obtiene lista de productos
    FS-->>PS: 4. Devuelve productos
    PS-->>S: 5. Muestra productos disponibles
    
    U->>PS: 6. Busca "remera roja"
    PS->>FS: 7. Busca en base de datos
    FS-->>PS: 8. Devuelve resultados
    PS-->>U: 9. Muestra productos encontrados
    
    U->>S: 10. Selecciona producto
    S->>C: 11. Agrega al carrito
    C-->>S: 12. Actualiza total
    S-->>U: 13. Muestra carrito actualizado
    
    U->>S: 14. Procesa pago
    S->>FS: 15. Guarda venta
    S->>FS: 16. Actualiza stock
    FS-->>S: 17. Confirma guardado
    S-->>U: 18. Muestra recibo
```

**Para principiantes:** Este diagrama muestra paso a paso c√≥mo funciona una venta.

---

## üì¶ Flujo de Gesti√≥n de Productos

```mermaid
graph LR
    A[üë§ Usuario en Products.jsx] --> B[üìã ProductsTable]
    B --> C[üî• Firebase: articulos]
    
    A --> D[‚ûï Crear Producto]
    D --> E[üìù ProductForm]
    E --> F[üì∏ Sube imagen a Storage]
    E --> G[üíæ Guarda en Firestore]
    
    A --> H[üîç Buscar Productos]
    H --> I[üîé ProductsFilters]
    I --> J[üìä Filtra resultados]
    
    A --> K[‚úèÔ∏è Editar Producto]
    K --> L[üìù ProductForm]
    L --> M[üîÑ Actualiza Firestore]
    
    C --> N[üì± Muestra en tabla]
    G --> N
    M --> N
    
    style A fill:#e1f5fe
    style C fill:#ffebee
    style F fill:#e8f5e8
    style G fill:#ffebee
```

**Para principiantes:** Aqu√≠ ves c√≥mo se crean, editan y muestran los productos.

---

## üî• Interacciones con Firebase

```mermaid
graph TB
    subgraph "üñ•Ô∏è Tu App React"
        A[üì± Componentes]
        B[üîß Hooks]
        C[‚öôÔ∏è Services]
    end
    
    subgraph "üî• Firebase"
        D[üîê Authentication]
        E[üìä Firestore Database]
        F[üìÅ Storage]
    end
    
    subgraph "üìä Colecciones Firestore"
        G[üì¶ articulos]
        H[üõí ventas]
        I[üë• clientes]
        J[üè™ proveedores]
    end
    
    A --> B
    B --> C
    
    C --> D
    C --> E
    C --> F
    
    E --> G
    E --> H
    E --> I
    E --> J
    
    style A fill:#e1f5fe
    style D fill:#ffcdd2
    style E fill:#ffcdd2
    style F fill:#ffcdd2
```

**Para principiantes:** Tu app habla con Firebase a trav√©s de los "services".

---

## üõí Flujo Detallado de una Venta

```mermaid
flowchart TD
    A[üõí Usuario inicia venta] --> B[üîç Busca producto]
    B --> C{üì¶ ¬øProducto encontrado?}
    
    C -->|‚ùå No| D[‚ö†Ô∏è Muestra "No encontrado"]
    C -->|‚úÖ S√≠| E[üìã Muestra opciones de variantes]
    
    E --> F[üë§ Usuario selecciona talla/color]
    F --> G{üìä ¬øHay stock?}
    
    G -->|‚ùå No| H[‚ö†Ô∏è Muestra "Sin stock"]
    G -->|‚úÖ S√≠| I[‚ûï Agrega al carrito]
    
    I --> J[üßÆ Calcula totales]
    J --> K{üõí ¬øM√°s productos?}
    
    K -->|‚úÖ S√≠| B
    K -->|‚ùå No| L[üí≥ Selecciona m√©todo de pago]
    
    L --> M[üí∞ Procesa pago]
    M --> N[üìù Crea registro de venta]
    N --> O[üìâ Actualiza stock]
    O --> P[üìÑ Genera recibo]
    P --> Q[‚úÖ Venta completada]
    
    style A fill:#e1f5fe
    style Q fill:#e8f5e8
    style D fill:#ffcdd2
    style H fill:#ffcdd2
```

**Para principiantes:** Este es el flujo completo de una venta, desde buscar hasta completar.

---

## üìä Flujo de Datos en Tiempo Real

```mermaid
sequenceDiagram
    participant C as üì± Componente
    participant H as üîß Hook
    participant S as ‚öôÔ∏è Service
    participant F as üî• Firestore
    
    Note over C,F: Carga inicial de datos
    C->>H: useProducts()
    H->>S: subscribeToProducts()
    S->>F: onSnapshot(collection)
    F-->>S: Datos iniciales
    S-->>H: Productos actuales
    H-->>C: Muestra productos
    
    Note over C,F: Cuando alguien m√°s cambia datos
    F->>S: üîî Notificaci√≥n de cambio
    S->>H: Nuevos datos
    H->>C: üîÑ Actualiza autom√°ticamente
    
    Note over C,F: Cuando t√∫ cambias datos
    C->>H: Crear producto
    H->>S: createProduct()
    S->>F: Guarda nuevo producto
    F-->>S: ‚úÖ Confirmaci√≥n
    F->>S: üîî Notifica cambio
    S->>H: Datos actualizados
    H->>C: üîÑ Actualiza lista
```

**Para principiantes:** Tu app se actualiza autom√°ticamente cuando alguien m√°s hace cambios.

---

## üóÇÔ∏è Estructura de Datos en Firebase

### üì¶ Colecci√≥n: `articulos` (Productos)
```javascript
{
  id: "REM001",                    // C√≥digo de barras
  articulo: "Remera B√°sica",       // Nombre del producto
  categoria: "mujer",              // Categor√≠a
  precioCosto: 1500,               // Precio de compra
  variantes: [                     // Diferentes tallas/colores
    {
      talle: "M",
      color: "Rojo",
      stock: 10,
      precioVenta: 3000
    },
    {
      talle: "L", 
      color: "Azul",
      stock: 5,
      precioVenta: 3000
    }
  ],
  proveedorId: "PROV001",          // ID del proveedor
  createdAt: "2024-01-15",         // Fecha de creaci√≥n
  updatedAt: "2024-01-20"          // √öltima actualizaci√≥n
}
```

### üõí Colecci√≥n: `ventas` (Ventas)
```javascript
{
  saleNumber: "20241215-001",      // N√∫mero √∫nico de venta
  items: [                         // Productos vendidos
    {
      productId: "REM001",
      productName: "Remera B√°sica",
      talle: "M",
      color: "Rojo", 
      price: 3000,
      quantity: 2,
      subtotal: 6000
    }
  ],
  paymentMethod: "Efectivo",       // M√©todo de pago
  total: 6000,                     // Total de la venta
  customerName: "Juan P√©rez",      // Cliente
  saleDate: "2024-12-15",         // Fecha de venta
  status: "completed"              // Estado
}
```

### üë• Colecci√≥n: `clientes` (Clientes)
```javascript
{
  nombre: "Juan P√©rez",            // Nombre del cliente
  telefono: "2604123456",          // Tel√©fono
  email: "juan@email.com",         // Email
  totalCompras: 15000,             // Total gastado
  cantidadCompras: 5,              // N√∫mero de compras
  ultimaCompra: "2024-12-15",      // √öltima compra
  fechaRegistro: "2024-01-10"      // Fecha de registro
}
```

---

## üîÑ Hooks y su Flujo de Datos

### `useProducts` - Gesti√≥n de Productos
```mermaid
graph LR
    A[üì± Componente usa useProducts] --> B[üîß Hook se conecta a Firebase]
    B --> C[üìä Obtiene productos en tiempo real]
    C --> D[üîÑ Actualiza estado local]
    D --> E[üì± Componente se re-renderiza]
    
    F[üë§ Usuario crea producto] --> G[üîß Hook llama createProduct]
    G --> H[üî• Firebase guarda producto]
    H --> I[üîî Firebase notifica cambio]
    I --> C
```

### `useSales` - Gesti√≥n de Ventas
```mermaid
graph LR
    A[üì± Componente de ventas] --> B[üîß useSales hook]
    B --> C[üõí Maneja carrito local]
    B --> D[üí∞ Procesa pagos]
    
    E[üë§ Usuario agrega producto] --> F[üîß addToCart]
    F --> G[üßÆ Calcula totales]
    G --> H[üì± Actualiza UI]
    
    I[üë§ Usuario paga] --> J[üîß processSale]
    J --> K[üî• Guarda en Firebase]
    K --> L[üìâ Actualiza stock]
    L --> M[‚úÖ Venta completada]
```

---

## üéØ Para Principiantes: Puntos Clave

### 1. **El flujo siempre es:**
```
Usuario ‚Üí Componente ‚Üí Hook ‚Üí Service ‚Üí Firebase ‚Üí Service ‚Üí Hook ‚Üí Componente ‚Üí Usuario
```

### 2. **Los datos van en dos direcciones:**
- **Hacia Firebase:** Cuando guardas algo nuevo
- **Desde Firebase:** Cuando cargas o actualizas datos

### 3. **Los hooks son el "cerebro":**
- Manejan el estado (qu√© datos tienes)
- Llaman a los services (para hablar con Firebase)
- Proveen funciones a los componentes

### 4. **Los services son los "mensajeros":**
- Hablan directamente con Firebase
- Convierten los datos al formato que necesitas
- Manejan errores de conexi√≥n

### 5. **Firebase es tu "almac√©n":**
- Guarda todos tus datos
- Los mantiene sincronizados en tiempo real
- Los protege con reglas de seguridad

---

## üö® Errores Comunes en el Flujo

### ‚ùå **Error 1: No esperar datos de Firebase**
```javascript
// MAL ‚ùå
const products = useProducts();
console.log(products[0].name); // Error si products est√° vac√≠o

// BIEN ‚úÖ
const products = useProducts();
if (products.length > 0) {
  console.log(products[0].name);
}
```

### ‚ùå **Error 2: No manejar estados de carga**
```javascript
// MAL ‚ùå
function ProductList() {
  const products = useProducts();
  return products.map(p => <div>{p.name}</div>);
}

// BIEN ‚úÖ
function ProductList() {
  const { products, loading } = useProducts();
  
  if (loading) return <div>Cargando...</div>;
  
  return products.map(p => <div>{p.name}</div>);
}
```

### ‚ùå **Error 3: Modificar datos directamente**
```javascript
// MAL ‚ùå
products[0].stock = 10; // No actualiza Firebase

// BIEN ‚úÖ
updateProduct(products[0].id, { stock: 10 }); // Usa el service
```

---

## üí° Consejos para Entender el Flujo

1. **Sigue el camino de los datos:** Desde donde se crean hasta donde se muestran
2. **Usa las herramientas de desarrollo:** Para ver qu√© datos tienes en cada momento
3. **Lee los console.log:** Te muestran qu√© est√° pasando paso a paso
4. **Empieza por un flujo simple:** Como mostrar una lista de productos
5. **Luego ve a flujos complejos:** Como procesar una venta completa

---

## üìö Pr√≥ximos Pasos

1. **Practica siguiendo un flujo:** Abre la app y ve paso a paso qu√© pasa cuando haces una venta
2. **Lee el c√≥digo de los hooks:** Especialmente `useProducts` y `useSales`
3. **Experimenta:** Agrega un `console.log` en diferentes partes para ver los datos
4. **Lee el Manual de Archivos Residuales:** Para entender qu√© c√≥digo no se usa

¬°Recuerda: entender el flujo de datos es clave para programar bien! üåä
